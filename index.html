<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0">
    <title>Яндекс.Дом</title>
    <link rel="preload" as="font" href="assets/lato.woff2" type="font/woff2" crossorigin="anonymous">
    <script src="vendors/react-with-dom.js"></script>
    <link rel="stylesheet" type="text/css" href="reset.css">
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>

<div id="app"></div>

<footer class="footer">
    <ul class="footer__list">
        <li class="footer__item">
            <a class="footer__link" href="/">Помощь</a>
        </li>
        <li class="footer__item">
            <a class="footer__link" href="/">Обратная связь</a>
        </li>
        <li class="footer__item">
            <a class="footer__link" href="/">Разработчикам</a>
        </li>
        <li class="footer__item">
            <a class="footer__link" href="/">Условия использования</a>
        </li>
    </ul>

    <div class="footer__copyright">
        © 1997–2023 ООО «Яндекс»
    </div>
</footer>

<script src="vendors/babel.min.js"></script>
<script type="text/babel">
    function Header() {
        const [expanded, setExpanded] = React.useState(false);

        const toggleMenu = () => {
            setExpanded(prev => !prev);
        };

        return (
            <header className="header">
                <a href="/" className="header__logo" aria-label="Яндекс.Дом"></a>
                <button
                    className="header__menu"
                    aria-expanded={expanded}
                    onClick={toggleMenu}
                    aria-label={expanded ? 'Закрыть меню' : 'Открыть меню'}
                />
                <ul className={`header__links ${expanded ? 'header__links_opened header__links-toggled' : ''}`}>
                    <li className="header__item">
                        <a className="header__link header__link_current" href="/" aria-current="page">Сводка</a>
                    </li>
                    <li className="header__item">
                        <a className="header__link" href="/devices">Устройства</a>
                    </li>
                    <li className="header__item">
                        <a className="header__link" href="/scripts">Сценарии</a>
                    </li>
                </ul>
            </header>
        );
    }

    const Event = React.memo(({icon, iconLabel, title, subtitle, slim}) => {
        return (
            <li className={slim ? 'event event_slim' : 'event'}>
                <button className="event__button">
                    <span className={`event__icon event__icon_${icon}`} role="img" aria-label={iconLabel}></span>
                    <h4 className="event__title">{title}</h4>
                    {subtitle && <span className="event__subtitle">{subtitle}</span>}
                </button>
            </li>
        );
    });

    const DEVICES = [
        {icon: 'light2', iconLabel: 'Освещение', title: 'Xiaomi Yeelight LED Smart Bulb', subtitle: 'Включено'},
        {icon: 'light', iconLabel: 'Освещение', title: 'D-Link Omna 180 Cam', subtitle: 'Включится в 17:00'},
        {icon: 'temp', iconLabel: 'Температура', title: 'Elgato Eve Degree Connected', subtitle: 'Выключено до 17:00'},
        {icon: 'light', iconLabel: 'Освещение', title: 'LIFX Mini Day & Dusk A60 E27', subtitle: 'Включится в 17:00'},
        {icon: 'light2', iconLabel: 'Освещение', title: 'Xiaomi Mi Air Purifier 2S', subtitle: 'Включено'},
        {icon: 'light', iconLabel: 'Освещение', title: 'Philips Zhirui', subtitle: 'Включено'},
    ];

    const TABS = {
        all: {title: 'Все', items: DEVICES},
        kitchen: {title: 'Кухня', items: [DEVICES[0], DEVICES[2]]},
        hall: {title: 'Зал', items: [DEVICES[5], DEVICES[4]]},
        lights: {title: 'Лампочки', items: DEVICES.filter(d => d.iconLabel === 'Освещение')},
        cameras: {title: 'Камеры', items: [DEVICES[1]]}
    };

    const TABS_KEYS = Object.keys(TABS);

    function Main() {
        const ref = React.useRef(null);
        const initedRef = React.useRef(false);
        const [activeTab, setActiveTab] = React.useState('');
        const [hasRightScroll, setHasRightScroll] = React.useState(false);

        React.useEffect(() => {
            if (!activeTab && !initedRef.current) {
                initedRef.current = true;
                setActiveTab(new URLSearchParams(location.search).get('tab') || 'all');
            }
        }, []);

        const onSelectInput = e => setActiveTab(e.target.value);

        const onArrowCLick = () => {
            const scroller = ref.current.querySelector('.section__panel:not(.section__panel_hidden)');
            scroller?.scrollTo({left: scroller.scrollLeft + 400, behavior: 'smooth'});
        };

        React.useEffect(() => {
            const panel = ref.current?.querySelector('.section__panel:not(.section__panel_hidden)');
            if (!panel) return;

            const checkScroll = () => {
                const newHasRightScroll = panel.scrollWidth > panel.clientWidth;
                setHasRightScroll(newHasRightScroll);
            };

            checkScroll();
            window.addEventListener('resize', checkScroll);
            return () => window.removeEventListener('resize', checkScroll);
        }, [activeTab]);

        return (
            <main className="main">
                <section className="section main__devices">
                    <div className="section__title">
                        <h2 className="section__title-header">Избранные устройства</h2>
                        <select className="section__select" defaultValue="all" onInput={onSelectInput}>
                            {TABS_KEYS.map(key => (
                                <option key={key} value={key}>{TABS[key].title}</option>
                            ))}
                        </select>
                        <ul role="tablist" className="section__tabs">
                            {TABS_KEYS.map(key => (
                                <li
                                    key={key}
                                    role="tab"
                                    aria-selected={key === activeTab}
                                    tabIndex={key === activeTab ? '0' : undefined}
                                    className={`section__tab${key === activeTab ? ' section__tab_active' : ''}`}
                                    id={`tab_${key}`}
                                    aria-controls={`panel_${key}`}
                                    onClick={() => setActiveTab(key)}
                                >
                                    {TABS[key].title}
                                </li>
                            ))}
                        </ul>
                    </div>
                    <div className="section__panel-wrapper" ref={ref}>
                        {TABS_KEYS.map(key => (
                            <div
                                key={key}
                                role="tabpanel"
                                className={`section__panel${key === activeTab ? '' : ' section__panel_hidden'}`}
                                aria-hidden={key !== activeTab}
                                id={`panel_${key}`}
                                aria-labelledby={`tab_${key}`}
                            >
                                <ul className="section__panel-list">
                                    {TABS[key].items.map((item, index) => (
                                        <Event key={index} {...item} />
                                    ))}
                                </ul>
                            </div>
                        ))}
                        {hasRightScroll && <div className="section__arrow" onClick={onArrowCLick}></div>}
                    </div>
                </section>
            </main>
        );
    }


    const root = ReactDOM.createRoot(document.getElementById('app'));
    root.render(
        <>
            <Header/>
            <Main/>
        </>
    );

</script>

</body>
</html>
